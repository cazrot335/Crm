<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scholarship Chatbot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Style bullets and numbered lists */
    .chat-box ul {
      list-style-type: disc;
      padding-left: 1.25rem;
      margin-top: 0.5rem;
    }

    .chat-box ol {
      list-style-type: decimal;
      padding-left: 1.25rem;
      margin-top: 0.5rem;
    }

    .chat-box li {
      margin-bottom: 0.3rem;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-white min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-xl bg-white shadow-xl rounded-2xl p-6">
    <h1 class="text-3xl font-bold text-center text-blue-700 mb-4">üéì ScholarBot</h1>
    <div id="chatBox" class="chat-box h-96 overflow-y-auto border border-gray-300 rounded p-4 bg-gray-50 text-sm mb-4 space-y-4"></div>
    <form id="chatForm" class="flex">
      <input type="text" id="userInput" class="flex-grow border border-gray-300 rounded-l px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Type your question..." required />
      <button type="submit" class="bg-blue-600 text-white px-5 py-2 rounded-r hover:bg-blue-700">Send</button>
    </form>
  </div>

  <script>
    const chatBox = document.getElementById("chatBox");
    const chatForm = document.getElementById("chatForm");
    const userInput = document.getElementById("userInput");

    const greetings = [
      "üéì Hello there! Ready to find the perfect scholarship for your dream studies abroad?",
      "üëã Hi! I‚Äôm ScholarBot ‚Äî here to help you explore scholarship opportunities. Let‚Äôs get started!",
      "üåç Hey! Thinking of studying abroad? I can guide you to the right scholarships. What‚Äôs your academic stream?",
      "‚úàÔ∏è Welcome! I help students like you find the best scholarships to study overseas. What field are you in?"
    ];

    // Initial greeting
    window.addEventListener("DOMContentLoaded", () => {
      const greeting = greetings[Math.floor(Math.random() * greetings.length)];
      addMessage("ScholarBot", greeting);
    });

    // Markdown-like formatter: converts - or * into bullets, 1. into numbers
    function formatMessage(content) {
      let html = content
        .replace(/^[-*]\s+(.*)$/gm, '<li>$1</li>')        // Bullets
        .replace(/^\d+\.\s+(.*)$/gm, '<li>$1</li>');      // Numbers

      // Wrap bullets with <ul> or <ol>
      if (html.match(/<li>/)) {
        const isOrdered = content.trim().match(/^\d+\./);
        const wrapper = isOrdered ? "ol" : "ul";
        html = `<${wrapper}>${html}</${wrapper}>`;
      }

      return html.replace(/\n/g, "<br>"); // Preserve line breaks
    }

    function addMessage(sender, message) {
      const msgDiv = document.createElement("div");
      const formatted = formatMessage(message);
      msgDiv.innerHTML = `<div><strong class="text-blue-700">${sender}:</strong><br>${formatted}</div>`;
      chatBox.appendChild(msgDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    chatForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const input = userInput.value.trim();
      if (!input) return;

      addMessage("You", input);
      userInput.value = "";

      const messages = [
        {
          role: "system",
          content: `
You are a friendly, empathetic assistant named ScholarBot who helps students find scholarships to study abroad.
You greet users warmly, ask about their academic background, preferred countries, and career goals.
You make helpful suggestions and format your responses as neat bullet or numbered lists.
Be clear and concise, but encouraging.
`
        },
        {
          role: "system",
          content: `
If a user mentions their stream (engineering, medicine, arts), suggest relevant scholarships and countries in point format.
If they mention countries (UK, Canada, Germany), suggest country-specific scholarships.
Always respond with clearly formatted, structured information.
`
        }
      ];

      const inputLower = input.toLowerCase();
      if (inputLower.includes("engineering")) {
        messages.push({
          role: "system",
          content: "User is from engineering background. Suggest STEM scholarships in USA, Germany, and Canada."
        });
      } else if (inputLower.includes("medicine")) {
        messages.push({
          role: "system",
          content: "User is from medicine background. Suggest scholarships in UK, Australia, and Ireland."
        });
      } else if (inputLower.includes("arts") || inputLower.includes("humanities")) {
        messages.push({
          role: "system",
          content: "User is from arts/humanities. Recommend creative scholarships and Europe-based programs."
        });
      } else if (inputLower.includes("uk") || inputLower.includes("canada") || inputLower.includes("germany")) {
        messages.push({
          role: "system",
          content: `User mentioned ${input}. Provide relevant opportunities and basic eligibility in that country.`
        });
      }

      messages.push({ role: "user", content: input });

      try {
        const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
          method: "POST",
          headers: {
            "Authorization": "Bearer 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",
            "Content-Type": "application/json",
            "HTTP-Referer": "https://yourdomain.com", // optional
            "X-Title": "Scholarship Chatbot"
          },
          body: JSON.stringify({
            model: "meta-llama/llama-3-8b-instruct",
            messages: messages
          })
        });

        const data = await response.json();
        const reply = data.choices?.[0]?.message?.content || "Sorry, I couldn't fetch a response.";
        addMessage("ScholarBot", reply);
      } catch (error) {
        console.error("Error:", error);
        addMessage("ScholarBot", "‚ùå Oops! Something went wrong. Please try again.");
      }
    });
  </script>
</body>
</html>
